:root{
  --bg:#f6efe2; --paper:#fffdf8; --ink:#1f2328; --sub:#60636b;
  --card:#fffaf3; --border:#eadac2;
  --primary:#0ea5a1; --accent:#d97757;
  --good:#16a34a; --warn:#b45309; --bad:#b91c1c;
  --radius:16px;

  --base-fs: clamp(15px, 2.2vmin, 28px);
  --btn-h: clamp(48px, 7vmin, 80px);
  --card-pad: clamp(14px, 1.6vmin, 22px);
  --gap: clamp(8px, 1.6vmin, 18px);

  --app-h: 100vh;
}

/* أساسيات */
*{box-sizing:border-box}
html,body{min-height:100vh}
body{
  margin:0;
  font-family:"Vazirmatn", system-ui, -apple-system, "Segoe UI", "Noto Naskh Arabic", "Amiri", serif;
  font-weight:600; font-size:var(--base-fs);
  background:
    radial-gradient(1100px 700px at 70% -40%, #f9e9cc 0%, transparent 65%),
    linear-gradient(160deg, var(--bg), #f9f2e7 60%);
  color:var(--ink);
  overflow-y:auto;
  padding-bottom: env(safe-area-inset-bottom, 0px);
}
h1,h2,h3,.headline,.title{font-family:"Amiri","Vazirmatn",serif}
:focus-visible{outline:3px solid #0ea5a1; outline-offset:3px}

/* رأس */
.site-header{
  position:sticky; top:0; z-index:50;
  display:flex; justify-content:space-between; align-items:center; gap:var(--gap);
  padding:calc(var(--gap)*1.0) calc(var(--gap)*1.2);
  background:#fffaf0cc; border-bottom:1px solid var(--border); backdrop-filter:blur(7px);
}
.brand{display:flex; align-items:center; gap:calc(var(--gap)*1.0)}
.icon-btn{
  min-width:calc(var(--btn-h)*0.75); min-height:calc(var(--btn-h)*0.75);
  border-radius:14px; border:1px solid var(--border);
  background:#fffdf8; color:#222; font-size:calc(var(--base-fs)*1.15); cursor:pointer;
}
.brand-title strong{font-size:calc(var(--base-fs)*1.05); font-weight:900}
.brand-title span{font-size:calc(var(--base-fs)*0.82); color:#7b7b7b}
.chip{
  background:#fff; color:#000; border:1px solid var(--border); border-radius:999px;
  padding:calc(var(--gap)*0.45) calc(var(--gap)*0.8); min-height:calc(var(--btn-h)*0.6); cursor:pointer
}

/* ستبر — بالنص */
.stepper{
  max-width:100vw; margin:var(--gap) auto 0; padding:0 calc(var(--gap)*1.2);
  display:grid; grid-auto-flow:column; grid-auto-columns:max-content; align-items:center; gap:calc(var(--gap)*0.6);
  overflow:auto; -webkit-overflow-scrolling:touch; justify-content:center;
}
.step{
  background:#fff; border:1px solid var(--border); border-radius:14px;
  padding:calc(var(--gap)*0.4) calc(var(--gap)*0.8); text-align:center; color:#7a6a58; font-size:calc(var(--base-fs)*0.9); white-space:nowrap;
}
.step.active{background:linear-gradient(90deg,#fefbf3,#fff); color:#1f1a13; font-weight:900; border-color:#e6d1b2}
.arrow{color:#c7a17a; text-align:center; font-size:calc(var(--base-fs)*1.0)}

/* إطار */
main{min-height:calc(var(--app-h) - 110px); padding:0 calc(var(--gap)*1.1)}
.screen{display:none; min-height:56vh;}
.screen.active{display:block}
.screen-content{
  min-height:56vh;
  display:flex; flex-direction:column; gap:var(--gap); align-items:center; justify-content:center;
  padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 12px);
}
.screen-content.center{justify-content:center}
.screen-content.start{justify-content:flex-start; padding-top:calc(var(--gap)*0.6)}
.title{margin:0; font-size:calc(var(--base-fs)*1.45); text-align:center; font-weight:900}

/* بطاقات عامة */
.card{
  background:#fffdfb; border:1px solid var(--border); border-radius:var(--radius);
  padding:var(--card-pad); width:min(100%, 92vw);
  box-shadow:0 10px 22px rgba(0,0,0,.06);
}
.card.tight{padding:calc(var(--card-pad)*0.8)}

/* بطل */
.hero{text-align:center}
.headline{margin:0 0 calc(var(--gap)*0.4); font-size:calc(var(--base-fs)*1.6); font-weight:900}
.tagline{color:#4c4c4c; margin:0 auto calc(var(--gap)*0.7); font-size:calc(var(--base-fs)*1.0)}

/* أزرار */
.btn{font-weight:800; border:none; cursor:pointer; border-radius:14px; padding:0 calc(var(--gap)*1.2); min-height:var(--btn-h); font-size:calc(var(--base-fs)*1.0)}
.btn.lg{min-height:calc(var(--btn-h)*0.95)}
.btn.xl{min-height:calc(var(--btn-h)*1.05); font-size:calc(var(--base-fs)*1.1)}
.btn.primary{background:linear-gradient(180deg,#10b3ae,#0ea5a1); color:#fff; box-shadow:0 10px 22px rgba(14,165,161,.22)}
.btn.accent{background:linear-gradient(180deg,#dda184,#d97757); color:#fff}
.btn.ghost{background:#fff; color:#333; border:1px solid var(--border)}
.btn:active{transform:translateY(1px)}
.nav-row{display:flex; align-items:center; gap:var(--gap); width:min(100%,92vw); justify-content:space-between}
.sticky-actions{position:sticky; bottom:0}

/* اختيار الحيوان */
.animal-grid{display:grid; grid-template-columns:repeat(4, 1fr); gap:var(--gap); width:min(100%,92vw)}
@media (max-width:1200px){ .animal-grid{grid-template-columns:repeat(2,1fr)} }
@media (max-width:640px){ .animal-grid{grid-template-columns:1fr} }
.animal-card{display:flex; align-items:center; gap:calc(var(--gap)*1.0); background:#fff; padding:calc(var(--gap)*1.0); min-height:calc(var(--btn-h)*1.2)}
.animal-card .big-emoji{font-size:calc(var(--base-fs)*2.0)}
.animal-card .name{font-weight:900; font-size:calc(var(--base-fs)*1.2)}
.badge{font-size:calc(var(--base-fs)*0.82); color:#5b3f2a; background:#fff3e1; border:1px solid #f3ddbd; border-radius:999px; padding:.2em .6em}
.badge.good{background:#e8fff7; border-color:#bfe9db; color:#176b5d}
.locked{opacity:.42}

/* الدروس */
.mag-slider{width:min(100%, 92vw); overflow:hidden; border-radius:14px}
.mag-track{display:flex; direction:ltr; transform:translateX(0); transition:transform .45s ease}
.slide{
  flex:0 0 100%; direction:rtl;
  background:#fff; color:#111;
  border:1px solid var(--border); border-radius:14px; padding:calc(var(--card-pad)*1.0);
  display:grid; gap:calc(var(--gap)*0.7); box-shadow:0 10px 22px rgba(0,0,0,.06);
  text-align:center;
}
.slide .kicker{color:#a1563c; letter-spacing:.6px; font-weight:900}
.slide h3{margin:0; font-size:calc(var(--base-fs)*1.45); font-weight:900}
.slide .lede{font-size:calc(var(--base-fs)*1.0); color:#3a3a3a}
.slide .points{display:grid; gap:.5em}
.slide .points > div{background:#fffaf4; border:1px dashed #eadac2; border-radius:10px; padding:.6em}
.mag-controls{display:flex; align-items:center; gap:.7em; width:min(100%,92vw); margin-top:calc(var(--gap)*0.3); flex-wrap:wrap}
.dots{display:flex; gap:.45em; align-items:center; justify-content:center; flex:1; min-width:160px}
.dot{width:10px; height:10px; border-radius:999px; background:#e5d5bd; border:1px solid #d8c4a6}
.dot.active{background:#d97757; border-color:#c96949}

/* بطاقات الأعلاف */
.feed-toolbar{margin-bottom:var(--gap)}
.feed .head{display:flex; flex-direction:column; gap:.2em; align-items:center; text-align:center}
.feed .name{font-weight:900; font-size:calc(var(--base-fs)*1.5)}
.feed .latin{color:#6a5a47; font-size:calc(var(--base-fs)*0.9)}
.badges{display:flex; gap:.5em; flex-wrap:wrap; margin:.3em 0}
.badges .chip{border-radius:999px; padding:.3em .7em; border:1px solid var(--border)}
.feed-grid{display:grid; gap:var(--gap); grid-template-columns: 1fr 1fr}
@media (max-width:900px){ .feed-grid{grid-template-columns:1fr} }
.specs{display:grid; grid-template-columns:repeat(4,1fr); gap:.6em}
@media (max-width:780px){ .specs{grid-template-columns:repeat(2,1fr)} }
.spec{background:#fff; border:1px solid var(--border); border-radius:12px; padding:.7em; text-align:center}
.spec .s{display:block; font-size:.8em; color:#6b6b6b}
.spec .v{display:block; font-weight:900; font-size:1.0em}
.section-title{font-weight:900; margin:.3em 0}
.list{display:flex; flex-direction:column; gap:.5em}
.list li{background:#fff; border:1px solid var(--border); border-radius:12px; padding:.65em}
.list li.bad{border-color:#f1c9c9; background:#fff0ف0; color:#7b1e1e}
.science{margin-top:.2em; background:#fff; border:1px dashed var(--border); border-radius:12px; padding:.7em}
.science small{color:#6b6b6b}

/* المصمّم — ٣ أعمدة */
.mixer-grid{
  display:grid; gap:var(--gap); width:min(100%, 92vw);
  grid-template-columns: 28vw 1fr 28vw;
}
@media (max-width:1200px){
  .mixer-grid{grid-template-columns:1fr}
}
.palette-head{display:flex; gap:var(--gap); align-items:center; margin-bottom:calc(var(--gap)*0.5)}
#feedSearch{flex:1; background:#fff; color:#111; border:1px solid var(--border); border-radius:12px; padding:.65em; font-size:1em}

/* قائمة المكوّنات = عمود واحد */
.palette-list{display:flex; flex-direction:column; gap:var(--gap)}
.p-card{background:#fff; border:1px solid var(--border); border-radius:14px; padding:.75em; display:flex; flex-direction:column; gap:.45em}
.pc-head{display:flex; align-items:center; justify-content:space-between}
.p-card .t{font-weight:900; font-size:1.02em}
.add-mini{border:1px solid var(--border); background:#fff; border-radius:999px; padding:.2em .6em; cursor:pointer}
.p-card .meta{color:#6b6b6b}
.p-card .actions{display:flex; justify-content:center}
.p-card .actions .btn{min-width:60%}

/* الأعلاف المضافة (وسط) */
.selected{display:flex; flex-direction:column; gap:var(--gap)}
.sel{
  background:#fff; border:1px solid var(--border); border-radius:14px; padding:1em;
  display:flex; flex-direction:column; align-items:center; gap:.6em;
}
.sel .name{font-weight:900; font-size:calc(var(--base-fs)*1.05); text-align:center}
.sel .meta{color:#6b6b6b; text-align:center}
.sel input[type=range]{width:100%}
.sel .row{display:flex; gap:.6em; align-items:center; justify-content:center}
.sel .pct{font-weight:900; min-width:56px; text-align:center}
.sel .rm{background:#fff0f0; color:#7b1e1e; border:1px solid #f1c9c9; border-radius:12px; min-height:calc(var(--btn-h)*0.7); padding:0 .9em}

/* عمود الإحصاءات (يمين) */
.chart-box{position:relative; display:flex; align-items:center; justify-content:center; background:#fff; border:1px solid var(--border); border-radius:14px; min-height:240px}
.chart-center{position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center}
#blendTotal{font-size:calc(var(--base-fs)*1.2); font-weight:900}
.metrics{display:grid; grid-template-columns:repeat(2,1fr); gap:var(--gap); margin-top:var(--gap)}
.metric{background:#fff; border:1px solid var(--border); border-radius:14px; padding:.75em}
.metric span{display:block; color:#6b6b6b; margin-bottom:.25em}
.metric strong{font-size:calc(var(--base-fs)*1.0)}
.warnings{list-style:none; margin:var(--gap) 0 0; padding:0; display:flex; flex-direction:column; gap:.5em}
.warnings li{background:#fff8ea; border:1px solid #f3ddbd; color:#7a4e0f; border-radius:12px; padding:.6em}
.warnings li.good{background:#eefcf7; border-color:#cdeee6; color:#0d5e52}
.mix-actions{display:flex; gap:.6em; flex-wrap:wrap; margin-top:var(--gap)}

/* المودال */
.modal{position:fixed; inset:0; background:rgba(0,0,0,.3); display:flex; align-items:center; justify-content:center; z-index:60}
.modal.hidden{display:none}
.modal-content .close{float:left; background:#fff; color:#4c4c4c; border:1px solid var(--border); border-radius:10px; min-height:calc(var(--btn-h)*0.6)}
.taste{display:flex; flex-direction:column; gap:var(--gap); align-items:center}
.taste .camel{font-size:calc(var(--base-fs)*1.9); animation:chew 1.1s infinite}
@keyframes chew{0%{transform:translateY(0)}50%{transform:translateY(-3px)}100%{transform:translateY(0)}}
.verdict{font-weight:900; font-size:calc(var(--base-fs)*1.0); text-align:center}

/* السباق — المضمار فوق السؤال وبثبات */
.quiz-stack{display:flex; flex-direction:column; gap:var(--gap); width:min(100%,92vw)}
.track{
  position:relative; background:#fff; border:1px dashed var(--border);
  height:160px; /* ارتفاع ثابت */
  border-radius:14px; overflow:hidden;
}
.finish.left-flag{position:absolute; left:1rem; top:1rem; font-size:calc(var(--base-fs)*1.0)}
.track .camel{
  position:absolute; right:1rem; top:calc(50% - 1rem); font-size:calc(var(--base-fs)*1.4);
  transition:right .45s ease;
}

/* صندوق السؤال بثبات نسبي */
.quiz{
  display:flex; flex-direction:column; gap:.7em; justify-content:center; align-items:center;
  min-height:260px; /* يمنع الانكماش */
}
.quiz .q{font-weight:900; text-align:center; font-size:calc(var(--base-fs)*1.15)}
.quiz .opt{
  width:100%; max-width:520px;
  border:none; border-radius:12px;
  min-height:calc(var(--btn-h)*0.95);
  font-weight:800; font-size:calc(var(--base-fs)*1.0);
  background:linear-gradient(180deg,#10b3ae,#0ea5a1); color:#fff;
  cursor:pointer; box-shadow:0 8px 18px rgba(14,165,161,.18);
}
.quiz .opt + .opt{margin-top:.4em}

/* توست + فوتر */
.toast{
  position:fixed; top:12px; left:50%; transform:translateX(-50%);
  background:#fff; color:#333; border:1px solid var(--border); border-radius:12px; padding:.7em 1em;
  opacity:0; pointer-events:none; transition:opacity .25s ease, transform .25s ease; z-index:80; box-shadow:0 10px 22px rgba(0,0,0,.06);
}
.toast.show{opacity:1; pointer-events:auto; transform:translateX(-50%) translateY(3px)}
.toast.good{border-color:#cdeee6; background:#eefcf7; color:#0d5e52}
.toast.bad{border-color:#f1c9c9; background:#fff0f0; color:#7b1e1e}
.site-footer{padding:calc(var(--gap)*1.0); text-align:center; color:#7b7b7b}
